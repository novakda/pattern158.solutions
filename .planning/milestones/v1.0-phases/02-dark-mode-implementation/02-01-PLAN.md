---
phase: 02-dark-mode-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - css/main.css
autonomous: true

must_haves:
  truths:
    - "Dark theme uses brand-aligned navy palette, not generic black"
    - "CSS custom properties enable instant theme switching without page reload"
    - "Toggle button has visible styling with icon visibility rules for both themes"
  artifacts:
    - path: "css/main.css"
      provides: "Dark mode token overrides and toggle button styling"
      contains: "[data-theme=\"dark\"]"
  key_links:
    - from: "[data-theme=\"dark\"] block"
      to: ":root token definitions"
      via: "CSS custom property override cascade"
      pattern: "\\[data-theme=\"dark\"\\].*--color-"
---

<objective>
Add dark mode CSS token overrides and theme toggle button styling to the existing design system.

Purpose: Establish the CSS foundation for dark mode by creating a `[data-theme="dark"]` block that overrides the 19 color tokens from `:root` with a brand-aligned navy palette (NTSB investigation aesthetic). Also add toggle button styles so the UI element is ready when HTML integration happens in Plan 02.

Output: Updated `css/main.css` with dark mode color overrides and toggle button CSS.
</objective>

<execution_context>
@/home/xhiris/.claude/get-shit-done/workflows/execute-plan.md
@/home/xhiris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dark-mode-implementation/02-RESEARCH.md
@css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dark mode color token overrides</name>
  <files>css/main.css</files>
  <action>
Add a `[data-theme="dark"]` CSS block immediately after the `:root` closing brace (after line 65) in css/main.css. This block overrides color tokens only -- typography, spacing, radius tokens remain unchanged across themes.

Override these color tokens with the brand-aligned navy palette:

```css
/* === DARK MODE OVERRIDES === */
[data-theme="dark"] {
    /* Backgrounds: navy-based palette (NTSB brand, NOT generic black) */
    --color-background: #1a2838;
    --color-background-alt: #243447;
    --color-surface: #2a3f54;

    /* Text: high contrast on dark backgrounds */
    --color-text: #e8e8e8;
    --color-text-muted: #a0a0a0;
    --color-text-light: #888888;
    --color-text-medium: #b0b0b0;
    --color-text-source: #909090;
    --color-text-timeline: #b0b0b0;

    /* Inverse: swap light/dark roles */
    --color-inverse: #faf9f6;
    --color-inverse-text: #1a2838;
    --color-inverse-text-muted: rgba(26, 40, 56, 0.8);
    --color-inverse-text-light: rgba(26, 40, 56, 0.7);

    /* Borders: lighter for visibility on dark */
    --color-border: #3d5266;
    --color-border-primary: rgba(23, 162, 184, 0.4);

    /* Hover state */
    --color-hover-background: #324456;

    /* Primary/Accent: keep teal and gold (good contrast on dark) */
    /* --color-primary: #17a2b8; -- no change needed */
    /* --color-primary-hover: #138496; -- no change needed */
    /* --color-accent: #b8860b; -- no change needed */

    /* Shadows: stronger for depth on dark backgrounds */
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
    --shadow-md: 0 2px 10px rgba(0, 0, 0, 0.5);
    --shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.6);

    /* Overlays: adjust for dark backgrounds */
    --overlay-hero: rgba(26, 40, 56, 0.80);
    --overlay-grid-line: rgba(23, 162, 184, 0.08);
    --overlay-hover-row: rgba(23, 162, 184, 0.1);
}
```

Key decisions per research:
- Primary (#17a2b8 teal) and accent (#b8860b gold) stay unchanged -- they have good contrast on both light and dark backgrounds.
- Background is navy #1a2838 (not generic black) to preserve NTSB investigation aesthetic.
- Text is #e8e8e8 (not pure white) for reduced eye strain.
- Shadows increase opacity (0.4-0.6 vs 0.08-0.2) because dark shadows vanish on dark backgrounds.
- Hero overlay increases from 0.65 to 0.80 for better text contrast.
- Inverse colors swap: inverse becomes cream (#faf9f6), inverse-text becomes navy (#1a2838). This is critical because nav uses --color-inverse for background -- in dark mode the nav should also use a dark background, but the inverse tokens swap so nav backgrounds on dark mode will become cream. WAIT -- re-examine this.

IMPORTANT CONSIDERATION: The nav uses `background: var(--color-inverse)` which is currently #1a2838 (dark navy). In dark mode, if we flip --color-inverse to #faf9f6, the nav becomes light cream on a dark page. This is probably NOT desired. The nav should stay dark in both themes. There are two approaches:

Option A: Don't swap --color-inverse at all in dark mode (keep nav dark in both themes).
Option B: Create a dedicated --color-nav-background token.

Use Option A: In the dark mode block, do NOT override --color-inverse, --color-inverse-text, --color-inverse-text-muted, or --color-inverse-text-light. The nav is dark (#1a2838) in light mode and should remain dark in dark mode. The inverse tokens are used primarily for nav, footer, and hero overlays -- all of which should maintain their dark appearance in dark mode.

Revised overrides (remove inverse token swaps):

```css
[data-theme="dark"] {
    --color-background: #1a2838;
    --color-background-alt: #243447;
    --color-surface: #2a3f54;
    --color-text: #e8e8e8;
    --color-text-muted: #a0a0a0;
    --color-text-light: #888888;
    --color-text-medium: #b0b0b0;
    --color-text-source: #909090;
    --color-text-timeline: #b0b0b0;
    --color-border: #3d5266;
    --color-border-primary: rgba(23, 162, 184, 0.4);
    --color-hover-background: #324456;
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
    --shadow-md: 0 2px 10px rgba(0, 0, 0, 0.5);
    --shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.6);
    --overlay-hero: rgba(26, 40, 56, 0.80);
    --overlay-grid-line: rgba(23, 162, 184, 0.08);
    --overlay-hover-row: rgba(23, 162, 184, 0.1);
}
```

Do NOT override: --color-primary, --color-primary-hover, --color-accent, --color-inverse, --color-inverse-text, --color-inverse-text-muted, --color-inverse-text-light, --shadow-focus, --shadow-focus-inverse, --text-shadow-hero, --text-shadow-hero-accent.

Verify the nav/footer/hero still look correct by checking what tokens they use. The nav background (`var(--color-inverse)`) stays #1a2838. Nav text (`var(--color-inverse-text)`) stays #faf9f6. Footer background (`var(--color-text)`) changes from #2d3436 to #e8e8e8 -- this IS a problem. The footer uses `background: var(--color-text)` which would become light in dark mode.

To fix the footer: The footer needs its own token or the CSS needs adjustment. Since we cannot add new HTML classes (CSS-only plan), the best fix is to add a dark mode override specifically for the footer:

```css
[data-theme="dark"] footer {
    background: var(--color-surface);
    color: var(--color-text);
}
```

This keeps the footer dark in dark mode. Add this rule after the token override block.

Also check for any other elements that use --color-text as a background. Search for `background.*--color-text` in main.css and handle each case.
  </action>
  <verify>
Verify the dark mode block exists and has correct token count:
- `grep -c "data-theme" css/main.css` should return at least 2 (the block selector + footer override)
- `grep -c "\-\-color-" css/main.css` should be higher than current count (new dark mode definitions added)
- Visually inspect the [data-theme="dark"] block follows immediately after :root closing brace
  </verify>
  <done>
`[data-theme="dark"]` block exists in css/main.css with brand-aligned navy palette overrides. Footer dark mode override present. No inverse token swaps that would break nav/hero appearance.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add theme toggle button CSS and icon visibility rules</name>
  <files>css/main.css</files>
  <action>
Add theme toggle button styles to css/main.css. Place these in the NAVIGATION section (after the existing `nav a:hover` rule, around line 178).

```css
/* --- Theme Toggle --- */
.theme-toggle {
    background: none;
    border: 2px solid transparent;
    color: var(--color-inverse-text);
    cursor: pointer;
    padding: var(--space-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-md);
    transition: color 0.3s, border-color 0.3s;
    width: 40px;
    height: 40px;
}

.theme-toggle:hover {
    color: var(--color-primary);
}

.theme-toggle:focus {
    outline: 2px solid var(--color-inverse-text);
    outline-offset: 2px;
    box-shadow: var(--shadow-focus-inverse);
}

/* Icon visibility: show moon in light mode, sun in dark mode */
.theme-toggle .icon-sun {
    display: none;
}
.theme-toggle .icon-moon {
    display: block;
}

[data-theme="dark"] .theme-toggle .icon-sun {
    display: block;
}
[data-theme="dark"] .theme-toggle .icon-moon {
    display: none;
}

/* Screen reader only utility (if not already present) */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}
```

Before adding `.sr-only`, check if it already exists in main.css. If it does, do not duplicate it.

The toggle button will be added as a `<li>` in the nav `<ul>` (done in Plan 02). The button uses `display: flex` for icon centering. Width/height of 40px ensures adequate touch target. Icons use `display: none/block` toggle (not opacity) for cleaner accessibility -- hidden icon is fully removed from layout.

Also add responsive rules for the toggle in the responsive section at the bottom of the file if needed (the 40x40 button should work at all viewport sizes without changes).
  </action>
  <verify>
- `grep "theme-toggle" css/main.css` returns multiple matches (class definitions)
- `grep "icon-sun" css/main.css` returns matches for visibility rules
- `grep "icon-moon" css/main.css` returns matches for visibility rules
- `grep "sr-only" css/main.css` returns exactly one definition (no duplicates)
  </verify>
  <done>
Theme toggle button has complete CSS: base styles, hover/focus states, icon visibility rules for both themes, and sr-only utility class. Button meets 40x40px touch target minimum.
  </done>
</task>

</tasks>

<verification>
1. `[data-theme="dark"]` block present in css/main.css with brand-aligned color overrides
2. No inverse token swaps that would break nav/footer/hero
3. Footer has dark mode override to maintain dark appearance
4. Theme toggle CSS complete with icon visibility rules
5. `.sr-only` utility present (not duplicated)
6. CSS file parses without errors (no syntax issues)
</verification>

<success_criteria>
- Dark mode tokens override background to navy #1a2838 (not black)
- Text tokens provide high contrast (#e8e8e8) on dark backgrounds
- Primary teal and accent gold unchanged between themes
- Nav and hero maintain dark appearance in both themes
- Footer explicitly overridden for dark mode
- Toggle button styled with accessible focus states
- Icon visibility correctly swaps between themes via CSS
</success_criteria>

<output>
After completion, create `.planning/phases/02-dark-mode-implementation/02-01-SUMMARY.md`
</output>

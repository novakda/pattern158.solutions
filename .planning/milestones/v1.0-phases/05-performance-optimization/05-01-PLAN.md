---
phase: 05-performance-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - css/main.css
  - index.html
  - philosophy.html
  - faq.html
  - contact.html
  - testimonials.html
  - exhibits/exhibit-a.html
  - exhibits/exhibit-b.html
  - exhibits/exhibit-c.html
  - exhibits/exhibit-d.html
  - exhibits/exhibit-e.html
  - exhibits/exhibit-f.html
  - exhibits/exhibit-g.html
  - exhibits/exhibit-h.html
  - exhibits/exhibit-i.html
  - exhibits/exhibit-j.html
  - exhibits/exhibit-k.html
  - exhibits/exhibit-l.html
  - assets/images/hero/pattern158_organ_pipes_hero.png
autonomous: true
requirements: [PERF-01, PERF-02, PERF-03]

must_haves:
  truths:
    - "Color contrast meets WCAG 4.5:1 for all primary-colored text and labels"
    - "Logo image has explicit width and height attributes preventing CLS on all pages"
    - "Hero background image is compressed to reduce LCP time"
    - "Font loading does not block page render (already true, preserved)"
  artifacts:
    - path: "css/main.css"
      provides: "Updated --color-primary token with WCAG-compliant contrast"
      contains: "--color-primary:"
    - path: "assets/images/hero/pattern158_organ_pipes_hero.png"
      provides: "Compressed hero image (smaller than current 148KB)"
    - path: "index.html"
      provides: "Logo img with both width and height attributes"
      contains: "width="
  key_links:
    - from: "css/main.css"
      to: "all HTML pages"
      via: "CSS custom property --color-primary"
      pattern: "--color-primary"
    - from: "all HTML pages"
      to: "logo image"
      via: "img tag with width and height attributes"
      pattern: 'width="\d+" height="48"'
---

<objective>
Fix the three Lighthouse-identified performance and accessibility issues: color contrast failure (WCAG 4.5:1), missing logo width attribute (CLS), and uncompressed hero image (LCP). Also confirm font loading and lazy loading requirements are already satisfied.

Purpose: Bring the site to Lighthouse 90+ on mobile across all pages and satisfy all Phase 5 performance requirements.
Output: Updated CSS with WCAG-compliant primary color, all 17 HTML pages with logo width attribute, compressed hero image.
</objective>

<execution_context>
@/home/xhiris/.claude/get-shit-done/workflows/execute-plan.md
@/home/xhiris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix color contrast and add logo width attribute</name>
  <files>css/main.css, index.html, philosophy.html, faq.html, contact.html, testimonials.html, exhibits/exhibit-a.html, exhibits/exhibit-b.html, exhibits/exhibit-c.html, exhibits/exhibit-d.html, exhibits/exhibit-e.html, exhibits/exhibit-f.html, exhibits/exhibit-g.html, exhibits/exhibit-h.html, exhibits/exhibit-i.html, exhibits/exhibit-j.html, exhibits/exhibit-k.html, exhibits/exhibit-l.html</files>
  <action>
Two changes in this task:

**A) Fix color contrast (css/main.css only)**

The current `--color-primary: #17a2b8` (teal) fails WCAG 4.5:1 contrast ratio against white backgrounds. Lighthouse flagged `.finding-label` (white text on teal background) and primary-colored links (teal text on white background).

Change the light-mode `:root` color token:
- `--color-primary: #17a2b8` → `--color-primary: #0e7c8c`
- `--color-primary-hover: #138496` → `--color-primary-hover: #0a6a78`

The new value `#0e7c8c` is a darker teal that achieves approximately 4.6:1 contrast against `#ffffff` while preserving the teal brand identity. The hover state is darkened proportionally.

Do NOT change any dark mode tokens. In dark mode, `--color-primary` is not overridden (it inherits from :root), and `#0e7c8c` on dark backgrounds (#1a2838, #2a3f54) will have sufficient contrast (teal on dark navy). Verify by checking that the contrast of `#0e7c8c` against `#1a2838` is above 4.5:1 and against `#2a3f54` is above 3:1 (for large text contexts like headings).

Also update any hardcoded rgba references to the old teal value `rgba(23, 162, 184, ...)` in the dark mode block:
- Line 84: `--color-border-primary: rgba(23, 162, 184, 0.4)` → `rgba(14, 124, 140, 0.4)`
- Line 96: `--overlay-grid-line: rgba(23, 162, 184, 0.08)` → `rgba(14, 124, 140, 0.08)`
- Line 97: `--overlay-hover-row: rgba(23, 162, 184, 0.1)` → `rgba(14, 124, 140, 0.1)`

Check for any OTHER hardcoded rgba(23, 162, 184, ...) in the :root block (line 25: `--color-border-primary`) and update those too.

**B) Add width attribute to logo img on all 17 pages**

The logo image is 1024x559 pixels (actual file). It is displayed at `height="48"`. The proportional width is: 48 * (1024/559) = 87.8, rounded to `width="88"`.

On each of the 17 HTML pages, find the logo `<img>` tag (currently at approximately line 64 or 92 depending on the page) and add `width="88"` alongside the existing `height="48"`.

Current pattern:
```html
<img src="/assets/images/logos/pattern158_logo_3pipes_detailed.png"
     alt="Pattern 158 - Provider of Clarity"
     class="logo-img"
     height="48">
```

New pattern:
```html
<img src="/assets/images/logos/pattern158_logo_3pipes_detailed.png"
     alt="Pattern 158 - Provider of Clarity"
     class="logo-img"
     width="88"
     height="48">
```

All 17 pages:
- Root: index.html, philosophy.html, faq.html, contact.html, testimonials.html
- Exhibits: exhibit-a.html through exhibit-l.html (12 files in exhibits/ subdirectory)
  </action>
  <verify>
1. Grep for `--color-primary:` in css/main.css and confirm it shows `#0e7c8c`
2. Grep for `#17a2b8` anywhere in css/main.css — should return zero matches (all old teal references replaced)
3. Grep for `width="88"` across all HTML files — should return exactly 17 matches (one per page)
4. Grep for `height="48"` across all HTML files without a nearby `width=` — should return zero (every height has a matching width)
  </verify>
  <done>
- --color-primary is #0e7c8c in :root (4.5:1+ contrast against white)
- --color-primary-hover is #0a6a78
- All hardcoded rgba(23, 162, 184, ...) values updated to rgba(14, 124, 140, ...)
- All 17 HTML pages have logo img with width="88" height="48"
- No CLS warning from missing dimensions
  </done>
</task>

<task type="auto">
  <name>Task 2: Compress hero image and validate all performance requirements</name>
  <files>assets/images/hero/pattern158_organ_pipes_hero.png</files>
  <action>
**A) Compress hero image**

The hero image `assets/images/hero/pattern158_organ_pipes_hero.png` is 148KB. Despite the .png extension, `file` reports it as JPEG data (JFIF standard 1.01, 1024x1024). Since it is actually JPEG, use JPEG compression tools, not PNG tools.

Per user decision: optimize the existing file, no format change, commit the optimized file.

Install jpegoptim if not available: `sudo apt-get install -y jpegoptim`

Run: `jpegoptim --max=85 --strip-all assets/images/hero/pattern158_organ_pipes_hero.png`

This applies lossy compression at quality 85 (visually indistinguishable) and strips EXIF/metadata. Target: reduce from 148KB to under 100KB.

If jpegoptim refuses due to the .png extension, use ImageMagick instead:
`convert assets/images/hero/pattern158_organ_pipes_hero.png -quality 85 -strip /tmp/hero_compressed.jpg && mv /tmp/hero_compressed.jpg assets/images/hero/pattern158_organ_pipes_hero.png`

Note: keeping the .png filename as-is per user decision (no format change means no rename). The CSS references this exact path.

**B) Validate all three PERF requirements are satisfied**

After compression, validate:

1. **PERF-01 (Images optimized)**: The hero image is compressed. The logo (16KB) and favicon (12KB) are already tiny — no action needed. WebP conversion explicitly skipped per user decision.

2. **PERF-02 (Lazy loading on non-critical images)**: Confirm there are no non-critical images. The only `<img>` tags are the logo (in the nav, above-fold on every page = critical). The hero is a CSS background-image (lazy loading attribute does not apply to CSS images). The favicon is loaded via `<link>`. Therefore, there are no candidates for `loading="lazy"` — requirement is satisfied by absence of non-critical images.

3. **PERF-03 (Font loading optimized)**: Confirm Google Fonts link includes `display=swap` and preconnect hints are present. Grep for `display=swap` and `preconnect.*fonts` in HTML files to verify. Already confirmed in Lighthouse audit — no changes needed.

Print a summary of all three requirement statuses to stdout.
  </action>
  <verify>
1. Check hero file size: `ls -la assets/images/hero/pattern158_organ_pipes_hero.png` — should be under 120KB (ideally under 100KB)
2. Verify CSS still references the correct path: grep for `pattern158_organ_pipes_hero` in css/main.css
3. Grep for `loading="lazy"` in all HTML — should return 0 matches (no non-critical images exist)
4. Grep for `display=swap` in all HTML — should return 17 matches (one per page, in Google Fonts link)
5. Grep for `preconnect.*fonts.googleapis.com` in all HTML — should return 17 matches
  </verify>
  <done>
- Hero image compressed from 148KB to under 120KB
- PERF-01 satisfied: images are optimized (hero compressed, WebP skipped per user decision)
- PERF-02 satisfied: no non-critical images exist to lazy-load (logo is above-fold, hero is CSS, favicon is link)
- PERF-03 satisfied: display=swap and preconnect already in place (confirmed, no changes needed)
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. All 17 pages load without errors (no broken image references)
2. `grep -r '#17a2b8' css/main.css` returns nothing (old color fully replaced)
3. `grep -r 'width="88"' *.html exhibits/*.html | wc -l` returns 17
4. Hero image is smaller than 148KB
5. No `loading="lazy"` attributes added (none needed)
6. `display=swap` confirmed present in all pages
</verification>

<success_criteria>
- Color contrast for --color-primary meets WCAG 4.5:1 against white (#ffffff) in light mode
- Logo img on all 17 pages has explicit width="88" and height="48" (no CLS)
- Hero image compressed (measurable size reduction from 148KB baseline)
- All three PERF requirements validated (PERF-01 via compression, PERF-02 via no-candidates confirmation, PERF-03 via display=swap confirmation)
- Site visual appearance preserved (darker teal is subtle, within brand palette)
</success_criteria>

<output>
After completion, create `.planning/phases/05-performance-optimization/05-01-SUMMARY.md`
</output>

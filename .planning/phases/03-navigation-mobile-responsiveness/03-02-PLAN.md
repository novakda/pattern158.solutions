---
phase: 03-navigation-mobile-responsiveness
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - index.html
  - philosophy.html
  - faq.html
  - contact.html
  - testimonials.html
  - exhibits/exhibit-a.html
  - exhibits/exhibit-b.html
  - exhibits/exhibit-c.html
  - exhibits/exhibit-d.html
  - exhibits/exhibit-e.html
  - exhibits/exhibit-f.html
  - exhibits/exhibit-g.html
  - exhibits/exhibit-h.html
  - exhibits/exhibit-i.html
autonomous: false

must_haves:
  truths:
    - "Clicking hamburger button on mobile opens the slide-in menu"
    - "Clicking hamburger button again closes the menu"
    - "Pressing Escape key closes the menu and returns focus to hamburger button"
    - "Pressing Enter or Space on hamburger button toggles the menu"
    - "Clicking outside the open menu closes it"
    - "aria-expanded updates correctly when menu opens/closes"
    - "Hamburger icon animates from 3 lines to X when active"
    - "Menu closes when a navigation link is clicked"
  artifacts:
    - path: "index.html"
      provides: "Navigation toggle script in all 14 pages"
      contains: "toggleMenu"
    - path: "index.html"
      provides: "Escape key handler for accessibility"
      contains: "Escape"
  key_links:
    - from: ".hamburger button click"
      to: ".nav-menu.is-open class toggle"
      via: "toggleMenu() function"
      pattern: "classList.toggle.*is-open"
    - from: "hamburger aria-expanded"
      to: "menu visibility state"
      via: "setAttribute in toggleMenu()"
      pattern: "aria-expanded"
---

<objective>
Add navigation toggle JavaScript to all 14 pages for hamburger menu state management, keyboard accessibility (Enter/Space/Escape), click-outside-to-close, and menu link auto-close. Complete with visual verification checkpoint.

Purpose: Wire up the hamburger menu behavior so mobile users can open/close navigation with full keyboard and touch accessibility.
Output: All 14 pages with inline navigation JS. Fully functional mobile hamburger menu.
</objective>

<execution_context>
@/home/xhiris/.claude/get-shit-done/workflows/execute-plan.md
@/home/xhiris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-navigation-mobile-responsiveness/03-RESEARCH.md
@.planning/phases/03-navigation-mobile-responsiveness/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add navigation toggle JavaScript to all 14 pages</name>
  <files>
    index.html
    philosophy.html
    faq.html
    contact.html
    testimonials.html
    exhibits/exhibit-a.html
    exhibits/exhibit-b.html
    exhibits/exhibit-c.html
    exhibits/exhibit-d.html
    exhibits/exhibit-e.html
    exhibits/exhibit-f.html
    exhibits/exhibit-g.html
    exhibits/exhibit-h.html
    exhibits/exhibit-i.html
  </files>
  <action>
Add the following inline `<script>` block to all 14 pages. Place it at the end of `<body>`, BEFORE the existing theme toggle script (the script that starts with `(function() { const toggle = document.getElementById('theme-toggle')`). The navigation script must load before the theme toggle script to ensure DOM order consistency.

**Navigation toggle script:**

```html
<!-- Navigation toggle -->
<script>
(function() {
    var hamburger = document.querySelector('.hamburger');
    var navMenu = document.querySelector('.nav-menu');

    if (!hamburger || !navMenu) return;

    function toggleMenu() {
        var isOpen = hamburger.getAttribute('aria-expanded') === 'true';
        var newState = !isOpen;

        hamburger.setAttribute('aria-expanded', String(newState));
        hamburger.classList.toggle('is-active', newState);
        navMenu.classList.toggle('is-open', newState);

        // Prevent body scroll when menu is open
        document.body.style.overflow = newState ? 'hidden' : '';
    }

    function closeMenu() {
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.classList.remove('is-active');
        navMenu.classList.remove('is-open');
        document.body.style.overflow = '';
    }

    // Click handler
    hamburger.addEventListener('click', toggleMenu);

    // Keyboard: Enter or Space activates button
    hamburger.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            toggleMenu();
        }
    });

    // Escape closes menu, returns focus to hamburger
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            var isOpen = hamburger.getAttribute('aria-expanded') === 'true';
            if (isOpen) {
                closeMenu();
                hamburger.focus();
            }
        }
    });

    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
        var isOpen = hamburger.getAttribute('aria-expanded') === 'true';
        if (isOpen && !navMenu.contains(e.target) && !hamburger.contains(e.target)) {
            closeMenu();
        }
    });

    // Close menu when a nav link is clicked (for same-page navigation)
    navMenu.addEventListener('click', function(e) {
        if (e.target.tagName === 'A') {
            closeMenu();
        }
    });

    // Close menu on window resize to desktop (cleanup stale mobile state)
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeMenu();
        }
    });
})();
</script>
```

**Key behaviors:**
1. `toggleMenu()`: Toggles `is-active` on hamburger, `is-open` on nav-menu, updates `aria-expanded`, prevents body scroll
2. `closeMenu()`: Explicitly closes (used by Escape, click-outside, link click, resize)
3. Enter/Space on hamburger: Calls `toggleMenu()` with `preventDefault` to stop Space from scrolling
4. Escape: Closes menu + returns focus to hamburger button (WCAG requirement)
5. Click outside: Closes menu (standard UX pattern)
6. Nav link click: Closes menu (so user sees the new page, not stale open menu)
7. Window resize > 768px: Resets menu state (prevents ghost state when rotating device)

**Script must use `var` not `let/const`** for maximum browser compatibility (static HTML site, no transpiler).

**Placement:** Insert BEFORE the theme toggle script block. Find the comment `<!-- Theme toggle script -->` or the pattern `(function() { const toggle = document.getElementById('theme-toggle')` and place navigation script above it. If no such comment exists, find the theme toggle script by its pattern and insert above.
  </action>
  <verify>
Run these checks:
- `grep -c "toggleMenu" index.html` returns 1+ (script present)
- `grep -rc "toggleMenu" *.html exhibits/*.html` shows all 14 files have the script
- `grep -rc "Escape" *.html exhibits/*.html` shows Escape handler in all 14 files
- `grep -rc "aria-expanded" *.html exhibits/*.html` shows aria-expanded handling in all 14 files
- `grep -c "closeMenu" index.html` returns 1+ (closeMenu function present)
- Verify script appears BEFORE theme toggle script in file
  </verify>
  <done>
All 14 pages contain the navigation toggle script with: click toggle, Enter/Space keyboard activation, Escape-to-close with focus return, click-outside-to-close, nav-link-to-close, and resize cleanup. Script uses `var` for compatibility. Placed before theme toggle script.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual and functional verification of navigation</name>
  <what-built>
Complete responsive navigation system across all 14 pages:
- Consistent nav links (Home, Philosophy, FAQ, Contact, Field Reports) on all pages
- Absolute-from-root paths (works from root and exhibits/ subdirectory)
- Mobile hamburger menu with slide-in animation
- Keyboard accessibility (Enter/Space to toggle, Escape to close)
- Touch targets meeting 48x48px minimum
  </what-built>
  <how-to-verify>
1. **Desktop verification:**
   - Open index.html in browser at desktop width (>768px)
   - Confirm horizontal nav shows: Home, Philosophy, FAQ, Contact, Field Reports, theme toggle
   - Confirm hamburger icon is NOT visible
   - Click each nav link -- verify it navigates to correct page
   - Navigate to exhibits/exhibit-a.html -- verify same nav links work from subdirectory

2. **Mobile verification:**
   - Resize browser to <768px (or use device toolbar)
   - Confirm hamburger icon appears (3 horizontal lines)
   - Confirm horizontal nav links are hidden
   - Click hamburger -- menu slides in from right
   - Confirm hamburger icon animates to X
   - Confirm menu has: Home, Philosophy, FAQ, Contact, Field Reports, theme toggle
   - Click a nav link -- menu closes
   - Open menu again, click outside menu -- menu closes
   - Open menu again, press Escape -- menu closes

3. **Keyboard verification:**
   - Tab to hamburger button
   - Press Enter -- menu opens
   - Press Escape -- menu closes, focus returns to hamburger
   - Press Space -- menu opens
   - Tab through menu items -- all links are focusable

4. **Cross-page consistency:**
   - Spot-check 3-4 pages (index, philosophy, one exhibit, testimonials)
   - Verify navigation is identical on all checked pages
   - Verify theme toggle still works in both desktop and mobile menu

5. **Dark mode:**
   - Toggle to dark mode
   - Verify mobile menu respects dark theme
   - Verify hamburger icon is visible in both themes
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Navigation JavaScript present on all 14 pages
2. Hamburger click opens/closes mobile menu
3. Escape key closes menu and returns focus
4. Enter/Space activate hamburger button
5. Click outside closes menu
6. Nav link click closes menu
7. aria-expanded updates correctly on toggle
8. Body scroll prevented when menu is open
9. Resize to desktop width resets menu state
10. Theme toggle still functional in both desktop and mobile contexts
11. Dark mode compatible with all navigation states
</verification>

<success_criteria>
- All 14 pages have navigation toggle JavaScript
- Mobile hamburger menu fully functional (open/close/animate)
- Keyboard accessibility: Enter, Space, Escape all work correctly
- Click-outside-to-close works
- aria-expanded reflects actual menu state
- Human verification passes on desktop, mobile, keyboard, dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation-mobile-responsiveness/03-02-SUMMARY.md`
</output>

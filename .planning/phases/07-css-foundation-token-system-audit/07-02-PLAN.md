---
phase: 07-css-foundation-token-system-audit
plan: 02
type: execute
wave: 2
depends_on:
  - 07-01
files_modified:
  - css/main.css
  - index.html
  - philosophy.html
  - faq.html
  - contact.html
  - testimonials.html
  - portfolio.html
  - technologies.html
  - exhibits/exhibit-a.html
  - exhibits/exhibit-b.html
  - exhibits/exhibit-c.html
  - exhibits/exhibit-d.html
  - exhibits/exhibit-f.html
  - exhibits/exhibit-g.html
  - exhibits/exhibit-h.html
  - exhibits/exhibit-i.html
  - exhibits/exhibit-j.html
  - exhibits/exhibit-k.html
  - exhibits/exhibit-l.html
autonomous: true
requirements:
  - CSS-05
  - CSS-06

must_haves:
  truths:
    - "Stats-bar component defined once in global COMPONENTS section, page-specific sections contain only overrides"
    - "CSS cascade layers control specificity -- no !important needed for page overrides"
    - "Zero inline style= attributes with hardcoded values remain in HTML files (all use var() or are moved to CSS)"
    - "Card variant base styles live in global COMPONENTS section"
  artifacts:
    - path: "css/main.css"
      provides: "Cascade layer structure and extracted shared components"
      contains: "@layer"
    - path: "css/main.css"
      provides: "Global COMPONENTS section with stats-bar, card variants"
      contains: ".stats-bar"
  key_links:
    - from: "css/main.css @layer components"
      to: "css/main.css @layer pages"
      via: "Cascade layer order guarantees pages override components"
      pattern: "@layer reset, base, components, pages, utilities"
    - from: "css/main.css .stats-bar (components)"
      to: ".page-testimonials .stat-label (pages)"
      via: "Page overrides only add page-specific differences"
      pattern: "\\.page-(testimonials|portfolio).*stat"
---

<objective>
Extract shared components to global CSS section, implement CSS cascade layers for clean specificity control, and convert remaining inline style= attributes in HTML files to proper CSS.

Purpose: CSS-05 (shared component extraction) eliminates duplication and establishes a single source of truth for shared components. CSS-06 (zero !important) is already achieved but cascade layers prevent future specificity wars. Inline style stragglers complete the Phase 6 cleanup.

Output: Restructured css/main.css with @layer cascade, extracted shared components, and all HTML files free of hardcoded inline styles.
</objective>

<execution_context>
@/home/xhiris/.claude/get-shit-done/workflows/execute-plan.md
@/home/xhiris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-css-foundation-token-system-audit/07-CONTEXT.md
@.planning/phases/07-css-foundation-token-system-audit/07-RESEARCH.md
@.planning/phases/07-css-foundation-token-system-audit/07-01-SUMMARY.md
@css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement cascade layers and extract shared components</name>
  <files>css/main.css</files>
  <action>
Restructure css/main.css to use CSS cascade layers. Add the layer declaration at the very top of the file (before the :root block):

```css
@layer reset, base, components, pages, utilities;
```

Then wrap existing sections in their appropriate layers:
- `@layer reset` -- the `* { margin: 0; padding: 0; box-sizing: border-box; }` block
- `@layer base` -- :root tokens, dark mode overrides, base typography (body, h1-h3, code), layout (.container, section), footer, accessibility styles (focus, skip-link, sr-only)
- `@layer components` -- the existing COMPONENTS section (buttons, card bases, hero-minimal) PLUS newly extracted shared components
- `@layer pages` -- all page-specific sections (Page: Index through Portfolio)
- `@layer utilities` -- sr-only utility class

**Note:** :root and [data-theme="dark"] token definitions should be OUTSIDE all layers (unlayered CSS has highest cascade priority, which is correct for token definitions). The navigation section should go in `@layer base` since it's shared across all pages.

Extract shared components to the `@layer components` block:

1. **stats-bar + stat-item**: Currently duplicated in .page-testimonials (line ~1460) and .page-portfolio (line ~3392). Extract the shared base:
   ```css
   .stats-bar {
       display: grid;
       grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
       gap: var(--space-lg);
   }
   .stat-item {
       padding: var(--space-lg) var(--space-md);
       border-top: 4px solid var(--color-primary);
       text-align: center;
   }
   .stat-number {
       font-family: var(--font-heading);
       font-size: var(--font-size-3xl);  /* use token from Plan 01 */
       color: var(--color-primary);
       line-height: 1;
   }
   .stat-label {
       font-size: var(--font-size-xs);  /* use token from Plan 01 */
       color: var(--color-text-muted);
       margin-top: var(--space-sm);
   }
   ```
   Then in the page sections, remove the duplicated base styles and keep ONLY page-specific overrides:
   - .page-testimonials: stat-item uses --color-background (not --color-surface), stat-label has text-transform: uppercase and letter-spacing
   - .page-portfolio: stat-item uses --color-surface (the default)

2. **hero-minimal**: Already in components section -- verify it's complete and doesn't have page-level duplications.

3. **card variants** (finding-card, exhibit-card, specialty-card): Already have a shared base at line ~425. Verify no duplicated base styles exist in page sections.

4. **probable-cause-box**: Currently uses verbose multi-selector pattern listing 4 exhibit pages (lines ~2408-2430). Keep as-is since it's page-scoped, but ensure it's in @layer pages.

Minor visual refinement during extraction is acceptable per user decision: ensure consistent border-radius on stat-items, aligned padding on card variants. No major visual changes.

**Important:** When wrapping in @layer, preserve the existing section comment structure (/* === SECTION NAME === */) for readability. The @layer wrapper goes around groups of related sections.
  </action>
  <verify>
Run: grep -c '@layer' css/main.css -- confirms layer declarations present (at least 6: 1 declaration + 5 layer blocks).
Run: grep '!important' css/main.css -- confirms still zero instances.
Run: grep -cP '\.page-(testimonials|portfolio)\s+\.stats-bar' css/main.css -- should return 0 or only override-specific selectors (base moved to components).
Open index.html, testimonials.html, portfolio.html, and one exhibit page in browser -- verify no visual regressions. Specifically check stats-bar sections on testimonials and portfolio pages look identical to before.
  </verify>
  <done>CSS file uses @layer cascade structure. Stats-bar extracted to global components with page-specific overrides only. Zero !important declarations. Card and hero-minimal bases confirmed in components layer.</done>
</task>

<task type="auto">
  <name>Task 2: Convert inline style= attributes in HTML to CSS classes</name>
  <files>
    css/main.css
    index.html
    philosophy.html
    faq.html
    contact.html
    testimonials.html
    portfolio.html
    technologies.html
    exhibits/exhibit-a.html
    exhibits/exhibit-b.html
    exhibits/exhibit-c.html
    exhibits/exhibit-d.html
    exhibits/exhibit-f.html
    exhibits/exhibit-g.html
    exhibits/exhibit-h.html
    exhibits/exhibit-i.html
    exhibits/exhibit-j.html
    exhibits/exhibit-k.html
    exhibits/exhibit-l.html
  </files>
  <action>
There are ~97 inline style= attributes across 17 HTML files. Per user decision: "Catch any inline style stragglers found during audit -- convert them to token-based CSS too, completing what Phase 6 started."

Convert each inline style to a CSS class or existing class. Common patterns found:

1. **Footer tagline** (appears on every page): `style="margin-top: 1rem; font-style: italic; color: var(--color-primary);"` -- Create `.footer-tagline` class in components layer.

2. **Footer attribution** (appears on every page): `style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--color-inverse-text-muted);"` -- Create `.footer-attribution` class in components layer.

3. **Section alternation backgrounds** on exhibits: `style="background: var(--color-surface);"` and `style="background: var(--color-background-alt);"` -- These use tokens already but should be CSS classes. Create `.section-surface` and `.section-alt` utility classes in the utilities layer, or use existing section styling patterns if the page CSS already handles alternation.

4. **Philosophy/FAQ testimonial section**: `style="margin-top: var(--space-2xl); border-top: 1px solid var(--color-border, rgba(255,255,255,0.1)); padding-top: var(--space-2xl);"` -- Create `.testimonial-divider` in components.

5. **Philosophy/FAQ testimonial heading**: `style="font-family: var(--font-heading); font-size: 1.6rem; color: var(--color-inverse); text-transform: uppercase; letter-spacing: 2px; margin-bottom: var(--space-xl);"` -- Create `.section-heading-styled` in components (use font-size token from Plan 01).

6. **Exhibit-specific inline styles** (report-section backgrounds, margin-top paragraphs, table column widths): Convert margin-top values to token-based CSS classes or add CSS rules for the specific selectors. Table column `style="width: X%"` can remain inline since percentage widths are structural layout, not design tokens.

7. **Index page tuning fork paragraph**: `style="font-size: 1.2rem; max-width: 800px; margin: 0 auto;"` -- Add CSS rule for this specific element.

8. **Contact page heading**: `style="margin-top: 3rem;"` -- Add to page CSS.

9. **Links with** `style="color: var(--color-primary);"` -- These already use tokens. If the link is inside a dark section where default link color differs, create a utility class `.link-primary` or add a CSS rule for the specific context.

For each conversion:
- Add the CSS class/rule to the appropriate @layer in main.css
- Update the HTML element to use class= instead of style=
- Ensure token values are used (var(--space-*), var(--font-size-*), var(--color-*))

**Exception:** Table column width percentages (`style="width: 5%"`, `style="width: 22%"`) can remain as inline styles -- these are structural data-dependent values, not design tokens.

After conversion, run grep to verify reduction. Target: zero inline styles with hardcoded values. A small number of inline styles using only var() references or structural widths is acceptable.
  </action>
  <verify>
Run: grep -rn 'style=' *.html exhibits/*.html | grep -v 'width:' | grep -v node_modules -- should show zero or near-zero results (only table width% exceptions).
Open philosophy.html, faq.html, exhibit-a.html, and contact.html in browser -- verify styles are applied correctly from CSS classes.
Verify dark mode still works on pages that had inline styles (philosophy testimonial section, exhibit section backgrounds).
  </verify>
  <done>All inline style= attributes with hardcoded or token values converted to CSS classes. Only structural width percentages remain as inline styles. HTML files are clean of presentational inline styles.</done>
</task>

</tasks>

<verification>
1. `grep -c '@layer' css/main.css` returns 6+ (declaration line + 5 layer blocks)
2. `grep '!important' css/main.css` returns 0 results
3. `grep -rn 'style=' *.html exhibits/*.html | grep -v 'width:' | grep -v node_modules | wc -l` returns 0 or near-zero
4. Stats-bar on testimonials.html and portfolio.html renders identically to before extraction
5. All 17 pages render without visual regressions in both light and dark modes
</verification>

<success_criteria>
- Shared components (stats-bar, card bases, hero-minimal) extracted to global COMPONENTS section within @layer components
- Page-scoped sections contain only overrides, wrapped in @layer pages
- CSS cascade layers declared: reset, base, components, pages, utilities
- Zero !important declarations (maintained)
- All inline style= attributes converted to CSS classes (except structural table widths)
- No visual regressions on any page in either light or dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/07-css-foundation-token-system-audit/07-02-SUMMARY.md`
</output>
